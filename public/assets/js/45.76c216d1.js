(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{725:function(t,s,a){t.exports=a.p+"assets/img/02.b18a7420.png"},795:function(t,s,a){"use strict";a.r(s);var e=a(8),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"自定义组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义组件"}},[t._v("#")]),t._v(" 自定义组件")]),t._v(" "),e("h3",{attrs:{id:"基本使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[t._v("#")]),t._v(" 基本使用")]),t._v(" "),e("p",[t._v("小程序在自定义组件时需要有四个基本文件。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("用于描述组件结构的 wxml 文件")])]),t._v(" "),e("li",[e("p",[t._v("用于描述组件样式的 wxss 文件")])]),t._v(" "),e("li",[e("p",[t._v("描述组件行为的 js 文件")])]),t._v(" "),e("li",[e("p",[t._v("声明组件配置的 json 文件")])])]),t._v(" "),e("p",[t._v("在 json 文件中需要配置为自定义组件。")]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"component"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("在 js 文件中需要初始化 Component 构造器。")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Component")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  behaviors"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  properties"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  data"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  lifetimes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  pageLifetimes"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  methods"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("p",[e("strong",[t._v("behaviors")]),t._v(": 共享逻辑，类似 vue 中的 mixins。可以包含一组对于"),e("code",[t._v("properties")]),t._v(","),e("code",[t._v("data")]),t._v(","),e("code",[t._v("lifetimes")]),t._v("和"),e("code",[t._v("methods")]),t._v("的定义。")]),t._v(" "),e("p",[e("strong",[t._v("properties")]),t._v(": 属性，类似于 Vue 和 React 中的 props。")]),t._v(" "),e("p",[e("strong",[t._v("data")]),t._v(": 类似于 Vue 中的 data 以及 React 中的 state。")]),t._v(" "),e("p",[e("strong",[t._v("pageLifetimes")]),t._v(": 用于定义此组件在页面特定生命周期时的行为。目前只支持"),e("code",[t._v("show")]),t._v(","),e("code",[t._v("hide")]),t._v(","),e("code",[t._v("resize")]),t._v("。")]),t._v(" "),e("p",[e("strong",[t._v("methods")]),t._v(": 与 Vue 的 methods 类似。")]),t._v(" "),e("p",[e("strong",[t._v("lifetimes")]),t._v(": 自定义组件的生命周期。")]),t._v(" "),e("h3",{attrs:{id:"生命周期"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生命周期"}},[t._v("#")]),t._v(" 生命周期")]),t._v(" "),e("p",[e("strong",[t._v("created")]),t._v(": 组件实例刚刚创建完,注意这时候还不能调用 setData，只应该用于给组件 this 添加一些自定义属性字段。")]),t._v(" "),e("p",[e("strong",[t._v("attached")]),t._v(": 组件完全初始化完毕，类似于 vue 中的 mounted。")]),t._v(" "),e("p",[e("strong",[t._v("detached")]),t._v(": 组件被移除时触发，类似 react 中的 unmounted。")]),t._v(" "),e("p",[e("strong",[t._v("ready")]),t._v(": 组件在视图层布局彻底完成。")]),t._v(" "),e("p",[e("strong",[t._v("moved")]),t._v(": 组件实例被移动时。")]),t._v(" "),e("p",[e("strong",[t._v("error")]),t._v("： 组件报错时执行。")]),t._v(" "),e("h3",{attrs:{id:"消息通信"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#消息通信"}},[t._v("#")]),t._v(" 消息通信")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s0.lgstatic.com/i/image/M00/68/F1/CgqCHl-lEjOAF8gdAABKdxPMcTk908.png",alt:""}})]),t._v(" "),e("p",[t._v("小程序上没有向 vuex 和 redux 这样的单项数据流，要实现通信的话只能在父组件上监听事件，然后子组件内部触发事件，然后把对应的信息带到上层。")]),t._v(" "),e("p",[t._v("或者可以在全局的 Page 上写一个 evnetbus，利用全局 App 做状态中转。")]),t._v(" "),e("h2",{attrs:{id:"双线程模型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#双线程模型"}},[t._v("#")]),t._v(" 双线程模型")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://zhaomenghuan.js.org/assets/img/wechat-miniprogram-framework.ad156d1c.png",alt:""}})]),t._v(" "),e("p",[t._v("小程序整体采用的是双线程模型. 一个渲染层,一个逻辑层.这两者会通过一个 native 层进行桥接.")]),t._v(" "),e("p",[t._v("其中在不同平台上的 js 执行环境也是不一样的")]),t._v(" "),e("p",[t._v("在安卓上,"),e("strong",[t._v("渲染层")]),t._v("用的是魔改后的移动端 chrome 内核,"),e("strong",[t._v("逻辑层")]),t._v("理所当然用的 v8")]),t._v(" "),e("p",[t._v("IOS 上,"),e("strong",[t._v("渲染层")]),t._v("用的 WKWebView(IOS 上的一个原声浏览器组件),"),e("strong",[t._v("逻辑层")]),t._v("跑在 jscore 里。")]),t._v(" "),e("h3",{attrs:{id:"为什么小程序采用双线程模型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么小程序采用双线程模型"}},[t._v("#")]),t._v(" 为什么小程序采用双线程模型？")]),t._v(" "),e("ol",[e("li",[e("p",[e("strong",[t._v("为了安全")]),t._v("。小程序逻辑代码的运行环境本质上是一个沙箱。小程序和微信的关系就和 codePen 上的那些案例和 codePen 平台一样，案例是不能影响平台正常运行的，必须要有一个隔离的环境。")])]),t._v(" "),e("li",[e("p",[e("strong",[t._v("为了性能")]),t._v("。有一种说法是，小程序中 js 逻辑线程是独立的，因此不会像"),e("code",[t._v("webworker")]),t._v("那样和主线程受到同一个 Page 的限制。")])])]),t._v(" "),e("p",[e("hide",{attrs:{txt:"个人其实不是很同意这种说法，感觉利用native做消息中转性能也好不到哪去吧。。。"}})],1),t._v(" "),e("h2",{attrs:{id:"oauth2-与小程序登录流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauth2-与小程序登录流程"}},[t._v("#")]),t._v(" OAuth2 与小程序登录流程")]),t._v(" "),e("h3",{attrs:{id:"oauth2-流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#oauth2-流程"}},[t._v("#")]),t._v(" OAuth2 流程")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.bilibili.com/video/BV1zt41127hX?from=search&seid=2919103034218757307",target:"_blank",rel:"noopener noreferrer"}},[t._v("优秀视频：OAuth2 流程科普"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("img",{attrs:{src:a(725),alt:""}})]),t._v(" "),e("p",[t._v("首先客户端要先取得用户的授权。")]),t._v(" "),e("p",[t._v("客户端拿到授权后，就带着授权去认证服务器换取 token。")]),t._v(" "),e("p",[t._v("换完 token 以后，就带着 token 去资源服务器，资源服务器会验证 token 是否有效，有效的话就返回给客户端相应的资源。")]),t._v(" "),e("h3",{attrs:{id:"小程序登录流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序登录流程"}},[t._v("#")]),t._v(" 小程序登录流程")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://s0.lgstatic.com/i/image/M00/67/6D/CgqCHl-hNu2AKHvwAAFHJorIbB4943.png",alt:""}})]),t._v(" "),e("p",[t._v("小程序登录流程本质上是 OAuth2.0 的具体实现。")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("当用户授权登陆后，小程序会调用"),e("code",[t._v("wx.login()")]),t._v("获取 code，这个 code 有效期只要五分钟。")])]),t._v(" "),e("li",[e("p",[t._v("小程序会调用"),e("code",[t._v("wx.request()")]),t._v("把这个 code 发给开发者服务器，开发者服务器会拿着 code，appid 和 appsecret 去换取 openid 和 session_key,session_key 是一个密钥，可以对用户的数据进行加密和解密，但是 openid 需要着重说一下。")])])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[e("img",{attrs:{src:"https://s0.lgstatic.com/i/image/M00/67/6D/CgqCHl-hNxeAaEBiAACDfUX77Nw561.png",alt:""}}),t._v(" "),e("code",[t._v("openid")]),t._v("可以理解为"),e("code",[t._v("unionid")]),t._v("和"),e("code",[t._v("appid")]),t._v("加密后的结果。")]),t._v(" "),e("p",[t._v("其中 unionid 才是真正用来表示用户的唯一 id，微信平台的应用体系不仅仅包含小程序，也包括公众号和其他接入微信开放平台的应用。")])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("当开发者服务器获取到 session_key 和 openid 后，便可以去创建 token 了，并且返回给小程序。此时小程序便拿到了 token。")])]),t._v(" "),e("h2",{attrs:{id:"小程序领域内性能优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序领域内性能优化"}},[t._v("#")]),t._v(" 小程序领域内性能优化")]),t._v(" "),e("p",[t._v("js 中的一些优化手段小程序这里肯定也是通用的。")]),t._v(" "),e("h3",{attrs:{id:"首次加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#首次加载"}},[t._v("#")]),t._v(" 首次加载")]),t._v(" "),e("p",[e("strong",[t._v("分包加载")]),t._v(": 懒加载在小程序场景下的实现。我们把访问频率高的页面放到主包里，把访问率底的页面放到分包里，访问的时候异步加载，这样可以大大降低首次 loading 的时间。")]),t._v(" "),e("p",[e("strong",[t._v("千万别用本地图片")]),t._v(": 图片这种东西对体积影响真的严重，放到云存储上最好。")]),t._v(" "),e("p",[e("strong",[t._v("预加载")]),t._v(": 可以在后台配置，可以在小程序冷启动时便去加载要加载的首页数据，从而提高加载速度。")]),t._v(" "),e("h3",{attrs:{id:"运行时-缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行时-缓存"}},[t._v("#")]),t._v(" 运行时(缓存)")]),t._v(" "),e("p",[e("strong",[t._v("周期性更新")]),t._v(": 对于一些更新频率很低的数据(通常大于 12 小时)，可以利用周期性更新来做缓存，这样就不用在运行时再发送请求。")]),t._v(" "),e("p",[e("strong",[t._v("setData")]),t._v(": 尽量在 setData 的调用频率和数据体量间找到一个“平衡”。")])])}),[],!1,null,null,null);s.default=n.exports}}]);