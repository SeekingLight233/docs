<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>sql语句学习笔记(sql-server) | SeekingLight</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="赋时光以生命">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.78041c82.css" as="style"><link rel="preload" href="/assets/js/app.4d15b3ce.js" as="script"><link rel="preload" href="/assets/js/3.8b0ceda2.js" as="script"><link rel="preload" href="/assets/js/1.ecdf2037.js" as="script"><link rel="preload" href="/assets/js/55.ec8677c2.js" as="script"><link rel="prefetch" href="/assets/js/10.5c997883.js"><link rel="prefetch" href="/assets/js/11.9bb87ee0.js"><link rel="prefetch" href="/assets/js/12.1bd6a3da.js"><link rel="prefetch" href="/assets/js/13.bb8170cf.js"><link rel="prefetch" href="/assets/js/14.94564b96.js"><link rel="prefetch" href="/assets/js/15.db064408.js"><link rel="prefetch" href="/assets/js/16.0c2439dc.js"><link rel="prefetch" href="/assets/js/17.7c5b96e4.js"><link rel="prefetch" href="/assets/js/18.6918828a.js"><link rel="prefetch" href="/assets/js/19.347abfc3.js"><link rel="prefetch" href="/assets/js/20.59bbd9ca.js"><link rel="prefetch" href="/assets/js/21.08b57689.js"><link rel="prefetch" href="/assets/js/22.2f773398.js"><link rel="prefetch" href="/assets/js/23.559109a9.js"><link rel="prefetch" href="/assets/js/24.96dae278.js"><link rel="prefetch" href="/assets/js/25.49026790.js"><link rel="prefetch" href="/assets/js/26.3e696b7f.js"><link rel="prefetch" href="/assets/js/27.964cdf16.js"><link rel="prefetch" href="/assets/js/28.dae74634.js"><link rel="prefetch" href="/assets/js/29.d37e9acb.js"><link rel="prefetch" href="/assets/js/30.882bd691.js"><link rel="prefetch" href="/assets/js/31.045b911d.js"><link rel="prefetch" href="/assets/js/32.42fbf541.js"><link rel="prefetch" href="/assets/js/33.000f0f72.js"><link rel="prefetch" href="/assets/js/34.b484515f.js"><link rel="prefetch" href="/assets/js/35.3dd430f5.js"><link rel="prefetch" href="/assets/js/36.303d6e5b.js"><link rel="prefetch" href="/assets/js/37.bfa9e033.js"><link rel="prefetch" href="/assets/js/38.bf80c844.js"><link rel="prefetch" href="/assets/js/39.5a128a4d.js"><link rel="prefetch" href="/assets/js/4.ff412fc0.js"><link rel="prefetch" href="/assets/js/40.d9741f71.js"><link rel="prefetch" href="/assets/js/41.7b42dd78.js"><link rel="prefetch" href="/assets/js/42.d5758950.js"><link rel="prefetch" href="/assets/js/43.fd82d19f.js"><link rel="prefetch" href="/assets/js/44.f6b0d30f.js"><link rel="prefetch" href="/assets/js/45.f8bb2eb9.js"><link rel="prefetch" href="/assets/js/46.b8b61cac.js"><link rel="prefetch" href="/assets/js/47.49abbcd5.js"><link rel="prefetch" href="/assets/js/48.d29e0d0d.js"><link rel="prefetch" href="/assets/js/49.d2c33c92.js"><link rel="prefetch" href="/assets/js/5.ed86cd32.js"><link rel="prefetch" href="/assets/js/50.7927818b.js"><link rel="prefetch" href="/assets/js/51.415c4fe8.js"><link rel="prefetch" href="/assets/js/52.758484f3.js"><link rel="prefetch" href="/assets/js/53.60c8b2d4.js"><link rel="prefetch" href="/assets/js/54.239baec0.js"><link rel="prefetch" href="/assets/js/56.1e1752e4.js"><link rel="prefetch" href="/assets/js/57.b5f3c61e.js"><link rel="prefetch" href="/assets/js/58.9feb07bb.js"><link rel="prefetch" href="/assets/js/59.2f437726.js"><link rel="prefetch" href="/assets/js/6.da9e88e2.js"><link rel="prefetch" href="/assets/js/60.39f6575b.js"><link rel="prefetch" href="/assets/js/7.658f24fb.js"><link rel="prefetch" href="/assets/js/8.a79692de.js"><link rel="prefetch" href="/assets/js/9.ef68ce12.js">
    <link rel="stylesheet" href="/assets/css/0.styles.78041c82.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-19557b78><div data-v-19557b78><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-19557b78 data-v-19557b78><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-19557b78 data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>SeekingLight</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>寻光</span>
            
          <span data-v-64685f0e>2017 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-19557b78><header class="navbar" data-v-19557b78><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/icon.png" alt="SeekingLight" class="logo"> <span class="site-name">SeekingLight</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/杂记/" class="nav-link"><i class="iconfont undefined"></i>
  杂记
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机组成原理/" class="nav-link"><i class="iconfont undefined"></i>
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/categories/Typescript/" class="nav-link"><i class="iconfont undefined"></i>
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="iconfont undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/色彩空间/" class="nav-link"><i class="iconfont undefined"></i>
  色彩空间
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/SeekingLight233" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/37019841?from=search&amp;seid=11160746842115235145" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  BiliBili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://music.163.com/#/user/home?id=355059838" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-douyin"></i>
  网易云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/contact.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  联系我
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-19557b78></div> <aside class="sidebar" data-v-19557b78><div class="personal-info-wrapper" data-v-042e23d4><img src="/images/hero.png" alt="author-avatar" class="personal-img" data-v-042e23d4> <h3 class="name" data-v-042e23d4>
    寻光
  </h3> <div class="num" data-v-042e23d4><div data-v-042e23d4><h3 data-v-042e23d4>46</h3> <h6 data-v-042e23d4>Article</h6></div> <div data-v-042e23d4><h3 data-v-042e23d4>83</h3> <h6 data-v-042e23d4>Tag</h6></div></div> <hr data-v-042e23d4></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/杂记/" class="nav-link"><i class="iconfont undefined"></i>
  杂记
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机组成原理/" class="nav-link"><i class="iconfont undefined"></i>
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/categories/Typescript/" class="nav-link"><i class="iconfont undefined"></i>
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/计算机网络/" class="nav-link"><i class="iconfont undefined"></i>
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/categories/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/色彩空间/" class="nav-link"><i class="iconfont undefined"></i>
  色彩空间
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/SeekingLight233" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/37019841?from=search&amp;seid=11160746842115235145" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-bilibili"></i>
  BiliBili
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://music.163.com/#/user/home?id=355059838" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-douyin"></i>
  网易云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/contact.html" class="nav-link"><i class="iconfont reco-wechat"></i>
  联系我
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>sql语句学习笔记(sql-server)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/sql.html#数据库创建" class="sidebar-link">数据库创建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/sql.html#数据库管理" class="sidebar-link">数据库管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#查看数据库" class="sidebar-link">查看数据库</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#修改数据库配置" class="sidebar-link">修改数据库配置</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#扩大与收缩数据库" class="sidebar-link">扩大与收缩数据库</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#删除数据库" class="sidebar-link">删除数据库</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#分离和附加数据库" class="sidebar-link">分离和附加数据库</a></li></ul></li><li><a href="/docs/sql.html#表结构的管理" class="sidebar-link">表结构的管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#创建表结构" class="sidebar-link">创建表结构</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#修改表结构" class="sidebar-link">修改表结构</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#删除表" class="sidebar-link">删除表</a></li></ul></li><li><a href="/docs/sql.html#表结构的完整控制" class="sidebar-link">表结构的完整控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#primary-key约束" class="sidebar-link">primary key约束</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#unique约束" class="sidebar-link">unique约束</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#check约束和default约束" class="sidebar-link">check约束和default约束</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#foreign-key约束" class="sidebar-link">foreign key约束</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#禁用约束" class="sidebar-link">禁用约束</a></li></ul></li><li><a href="/docs/sql.html#表内容的管理" class="sidebar-link">表内容的管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#insert" class="sidebar-link">insert</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#delete" class="sidebar-link">delete</a></li></ul></li><li><a href="/docs/sql.html#数据基本查询" class="sidebar-link">数据基本查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#选择字段" class="sidebar-link">选择字段</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#选择行" class="sidebar-link">选择行</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#数据排序查询" class="sidebar-link">数据排序查询</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#使用计算函数" class="sidebar-link">使用计算函数</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#对查询结果分组计算" class="sidebar-link">对查询结果分组计算</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#into语句" class="sidebar-link">into语句</a></li></ul></li><li><a href="/docs/sql.html#子查询" class="sidebar-link">子查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#单值嵌套查询" class="sidebar-link">单值嵌套查询</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#多值嵌套查询" class="sidebar-link">多值嵌套查询</a></li></ul></li><li><a href="/docs/sql.html#连接查询" class="sidebar-link">连接查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#自连接" class="sidebar-link">自连接</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#内部连接" class="sidebar-link">内部连接</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#外部连接" class="sidebar-link">外部连接</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#交叉连接" class="sidebar-link">交叉连接</a></li></ul></li><li><a href="/docs/sql.html#集合运算查询" class="sidebar-link">集合运算查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#并运算" class="sidebar-link">并运算</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#交运算" class="sidebar-link">交运算</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#差运算" class="sidebar-link">差运算</a></li></ul></li><li><a href="/docs/sql.html#case函数查询" class="sidebar-link">case函数查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#简单case函数" class="sidebar-link">简单case函数</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#搜索case函数" class="sidebar-link">搜索case函数</a></li></ul></li><li><a href="/docs/sql.html#索引" class="sidebar-link">索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#创建索引" class="sidebar-link">创建索引</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#管理索引" class="sidebar-link">管理索引</a></li></ul></li><li><a href="/docs/sql.html#视图" class="sidebar-link">视图</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#创建视图" class="sidebar-link">创建视图</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#通过视图查询数据" class="sidebar-link">通过视图查询数据</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#通过视图修改数据" class="sidebar-link">通过视图修改数据</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#查看和重命名视图" class="sidebar-link">查看和重命名视图</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#修改和删除视图" class="sidebar-link">修改和删除视图</a></li></ul></li><li><a href="/docs/sql.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#创建和调用函数" class="sidebar-link">创建和调用函数</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#管理用户定义函数" class="sidebar-link">管理用户定义函数</a></li></ul></li><li><a href="/docs/sql.html#游标" class="sidebar-link">游标</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#声明游标" class="sidebar-link">声明游标</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#打开游标" class="sidebar-link">打开游标</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#读取游标数据" class="sidebar-link">读取游标数据</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#用游标修改和删除数据" class="sidebar-link">用游标修改和删除数据</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#关闭和删除游标" class="sidebar-link">关闭和删除游标</a></li></ul></li><li><a href="/docs/sql.html#事务" class="sidebar-link">事务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/sql.html#存储过程" class="sidebar-link">存储过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#存储过程创建" class="sidebar-link">存储过程创建</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#存储过程执行" class="sidebar-link">存储过程执行</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#删除存储过程" class="sidebar-link">删除存储过程</a></li></ul></li><li><a href="/docs/sql.html#触发器" class="sidebar-link">触发器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sql.html#dml触发器" class="sidebar-link">DML触发器</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#ddl触发器" class="sidebar-link">DDL触发器</a></li><li class="sidebar-sub-header"><a href="/docs/sql.html#管理触发器" class="sidebar-link">管理触发器</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-19557b78><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>sql语句学习笔记(sql-server)</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>寻光</span>
            
          <span data-v-64685f0e>2017 - </span>
          2022
        </a></span></div></div> <div data-v-19557b78><main class="page"><div class="page-title" style="display:none;"><h1>sql语句学习笔记(sql-server)</h1> <hr> <div data-v-34ea29db><i class="iconfont reco-account" data-v-34ea29db><span data-v-34ea29db>寻光</span></i> <i class="iconfont reco-date" data-v-34ea29db><span data-v-34ea29db>2019-12-24</span></i> <!----> <i class="iconfont reco-tag tags" data-v-34ea29db><span class="tag-item" data-v-34ea29db>常用sql语句</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><p>前几天的MongoDB被盗真的是把本蒟蒻难受坏了，如果自己当初会sql还用啥MongoDB啊 😭😭</p> <p>简单的把常用的sql语句整理总结下，主要还是为了方便自己以后操作sql类数据库<s>以及和应付期末考试</s>。</p> <p>本笔记中的sql语句测试环境为sql-server 2008 R2。</p> <p>内容总结相对入门和基础，具体语句的详细使用还请您查阅各数据库官方文档。</p> <p><a href="https://docs.microsoft.com/zh-cn/sql/t-sql/statements/statements?view=sql-server-ver15" target="_blank" rel="noopener noreferrer">Transact-SQL 语句<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.mysqlzh.com/doc/124.html" target="_blank" rel="noopener noreferrer">SQL语句语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="数据库创建"><a href="#数据库创建" class="header-anchor">#</a> 数据库创建</h2> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> 数据库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="数据库管理"><a href="#数据库管理" class="header-anchor">#</a> 数据库管理</h2> <h3 id="查看数据库"><a href="#查看数据库" class="header-anchor">#</a> 查看数据库</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">use</span> 数据库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="修改数据库配置"><a href="#修改数据库配置" class="header-anchor">#</a> 修改数据库配置</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">database</span> 数据库名

后续<span class="token keyword">sql</span>操作语句
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="扩大与收缩数据库"><a href="#扩大与收缩数据库" class="header-anchor">#</a> 扩大与收缩数据库</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">--扩大数据库</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> 数据库名
<span class="token keyword">modify</span> <span class="token keyword">file</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> 数据库中的主要数据文件名，
    size <span class="token operator">=</span> 修改后的文件大小
<span class="token punctuation">)</span>
<span class="token comment">--收缩整个数据库,使school数据库中的所有文件都有20%的可用空间</span>
<span class="token keyword">dbcc</span> shrinkdatabase<span class="token punctuation">(</span>school<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--收缩指定数据文件，使school数据库中的class文件收缩到4 MB</span>
<span class="token keyword">dbcc</span> shrinkfile<span class="token punctuation">(</span>class<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="删除数据库"><a href="#删除数据库" class="header-anchor">#</a> 删除数据库</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">database</span> 数据库名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="分离和附加数据库"><a href="#分离和附加数据库" class="header-anchor">#</a> 分离和附加数据库</h3> <h4 id="分离"><a href="#分离" class="header-anchor">#</a> 分离</h4> <blockquote><p>分离数据库是指将数据库从sql server的实例中删除，但文件依然存在，是可以找回来的。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">exec</span> sp_detach_db <span class="token string">'数据库名'</span><span class="token punctuation">,</span><span class="token string">'true'</span><span class="token punctuation">;</span>

<span class="token comment">--当后面追加参数true代表分离后跳过显示统计信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="附加"><a href="#附加" class="header-anchor">#</a> 附加</h4> <blockquote><p>将分离下来的数据库重新附加到sql server上</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">--将school数据库附加到school数据库实例上去</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> school
<span class="token keyword">on</span><span class="token punctuation">(</span>filename <span class="token operator">=</span> <span class="token string">'数据文件路径'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> attach
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="表结构的管理"><a href="#表结构的管理" class="header-anchor">#</a> 表结构的管理</h2> <h3 id="创建表结构"><a href="#创建表结构" class="header-anchor">#</a> 创建表结构</h3> <h4 id="基本语法"><a href="#基本语法" class="header-anchor">#</a> 基本语法</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> 表名称<span class="token punctuation">(</span>
    字段名<span class="token number">1</span> 数据类型 约束<span class="token punctuation">,</span>
    字段名<span class="token number">2</span> 数据类型 约束<span class="token punctuation">,</span>
    字段名<span class="token number">3</span> 数据类型 约束<span class="token punctuation">,</span>
    追加约束<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="修改表结构"><a href="#修改表结构" class="header-anchor">#</a> 修改表结构</h3> <h4 id="添加"><a href="#添加" class="header-anchor">#</a> 添加</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 向student表中添加住址和邮政编码字段。</span>
<span class="token keyword">use</span> school
go
<span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">add</span>
address <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
code <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="修改"><a href="#修改" class="header-anchor">#</a> 修改</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将student表中的sdept字段改为varchar类型，长度为30，并设置该字段不能为空</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">alter</span> <span class="token keyword">column</span> sdept <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">not</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将student表中的address字段删除</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">drop</span> <span class="token keyword">column</span> address
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="重命名"><a href="#重命名" class="header-anchor">#</a> 重命名</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将student表中zipcode字段更名为zip</span>
<span class="token keyword">exec</span> sp_rename <span class="token string">'student.zipcode'</span><span class="token punctuation">,</span><span class="token string">'zip'</span><span class="token punctuation">,</span><span class="token string">'column'</span><span class="token punctuation">;</span>

<span class="token comment">-- 将表sc重命名为'score'</span>
<span class="token keyword">exec</span> sp_rename <span class="token string">'sc'</span><span class="token punctuation">,</span><span class="token string">'score'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="删除表"><a href="#删除表" class="header-anchor">#</a> 删除表</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 删除数据库中的sc表</span>
<span class="token keyword">use</span> school
go
<span class="token keyword">drop</span> sc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="表结构的完整控制"><a href="#表结构的完整控制" class="header-anchor">#</a> 表结构的完整控制</h2> <h3 id="primary-key约束"><a href="#primary-key约束" class="header-anchor">#</a> primary key约束</h3> <blockquote><p>用来唯一标识当前数据表中的某一行</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将course表中的cno字段设置为主键</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">add</span> <span class="token keyword">constraint</span> pk_cno <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>cno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除上面设置的主键约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">drop</span> <span class="token keyword">constraint</span> pk_cno<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="unique约束"><a href="#unique约束" class="header-anchor">#</a> unique约束</h3> <blockquote><p>用来保证字段中的所有数据各不相同</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建department表时为id这个字段设置uniqe约束</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> department<span class="token punctuation">(</span>
    id <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">constraint</span> u_id uniqe<span class="token punctuation">,</span>
    dname <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">-- 为上表中的name字段设置unique约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> department
<span class="token keyword">add</span> <span class="token keyword">constraint</span> u_name uniqe<span class="token punctuation">(</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="check约束和default约束"><a href="#check约束和default约束" class="header-anchor">#</a> check约束和default约束</h3> <blockquote><p>check约束用来保证列中的所有值必须要满足的条件
default约束用来保证列中数据未指定时的缺省值</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建student表时为sex字段添加check约束并默认设置字段值为‘男’</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">check</span><span class="token punctuation">(</span>sex <span class="token operator">=</span> <span class="token string">'男'</span> <span class="token operator">or</span> sex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'男'</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="foreign-key约束"><a href="#foreign-key约束" class="header-anchor">#</a> foreign key约束</h3> <blockquote><p>用来唯一标识其他数据表中的某一行</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建scorel表，包含sno，cno，和grade字段，在sno和cno上设置主键，同时设置sno字段为student表中sno字段的外键</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> scorel<span class="token punctuation">(</span>
    sno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>snp<span class="token punctuation">,</span>cno<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>sno<span class="token punctuation">)</span> <span class="token keyword">references</span> student<span class="token punctuation">(</span>sno<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 手动为上面表中的cno字段设置为course表中cno字段的外键</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> scorel <span class="token keyword">add</span> <span class="token keyword">constraint</span> fk_cno <span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">(</span>cno<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>cno<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="禁用约束"><a href="#禁用约束" class="header-anchor">#</a> 禁用约束</h3> <blockquote><p>某些特殊情况我们可能会选择先禁用掉约束，而不是删除约束。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 暂时禁止student表中设置的性别约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> student
<span class="token keyword">with</span> nocheck
<span class="token keyword">add</span> <span class="token keyword">constraint</span> ck_sex <span class="token keyword">check</span><span class="token punctuation">(</span>sex <span class="token operator">=</span> <span class="token string">'男'</span> <span class="token operator">or</span> sex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 启用student表中的性别约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">check</span> <span class="token keyword">constraint</span> ck_sex<span class="token punctuation">;</span>

<span class="token comment">-- 禁用scorel表中所有的约束</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> scorel
nocheck <span class="token keyword">constraint</span> <span class="token keyword">all</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="表内容的管理"><a href="#表内容的管理" class="header-anchor">#</a> 表内容的管理</h2> <h3 id="insert"><a href="#insert" class="header-anchor">#</a> insert</h3> <blockquote><p>insert into语句用于我们向表中添加新的行</p></blockquote> <h4 id="不指定字段名称根据字段顺序插入全部字段值"><a href="#不指定字段名称根据字段顺序插入全部字段值" class="header-anchor">#</a> 不指定字段名称根据字段顺序插入全部字段值</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 假设student表中只有id，name，sex这三个字段,并且性别字段可以为空</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'0001'</span><span class="token punctuation">,</span><span class="token string">'吴亦凡'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'0002'</span><span class="token punctuation">,</span><span class="token string">'蔡徐坤'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="指定字段名称插入部分字段值"><a href="#指定字段名称插入部分字段值" class="header-anchor">#</a> 指定字段名称插入部分字段值</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在student表中添加新的人物</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'0003'</span><span class="token punctuation">,</span><span class="token string">'五五开'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 此时五五开就被添加进了学生表，同时性别栏为空</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="update"><a href="#update" class="header-anchor">#</a> update</h3> <blockquote><p>update语句用于修改表中的字段值</p></blockquote> <div class="language- extra-class"><pre><code>| ID | NAME     | AGE | ADDRESS   |
+----+----------+-----+-----------+
|  1 | mike     |  19 | beijing   |
|  2 | katy     |  25 | hangzhou  |
|  3 | jason    |  20 | shenyang  |
|  4 | mimgming |  18 | shanghai  |
|  5 | hongh    |  21 | zhengzhou |
|  6 | hanghang |  22 | tianjin   |
|  7 | peter    |  22 | guangzhou |
+----+----------+-----+-----------+
</code></pre></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将上述people表中的年龄都改为20岁</span>
<span class="token keyword">update</span> people <span class="token keyword">set</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> HEAD
<span class="token comment">-- 基于条件的更新，将id为2的条目地址改为zhejaing</span>
<span class="token keyword">update</span> people <span class="token keyword">set</span> address <span class="token operator">=</span> zhejiang <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>
<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span> HEAD
<span class="token comment">-- 基于条件的更新，将id为2的条目地址改为zhejiang,age改为18</span>
<span class="token keyword">update</span> people <span class="token keyword">set</span> address <span class="token operator">=</span> zhejiang<span class="token punctuation">,</span>age <span class="token operator">=</span> <span class="token number">18</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> 
<span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>
<span class="token comment">-- 基于条件的更新，将id为2的条目地址改为zhejaing</span>
<span class="token keyword">update</span> people <span class="token keyword">set</span> address <span class="token operator">=</span> zhejiang <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a6d99de767cc1db3754c54c25d6b940084f50a9b
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ac6ab2c78f3bb499c9c143bcf1d0fbf7a3eca667
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="delete"><a href="#delete" class="header-anchor">#</a> delete</h3> <blockquote><p>delete语句用于删除表中的一行或者多行数据</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 删除stu表中的所有行(所有内容)</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> stu

<span class="token comment">-- 删除stu表中没有地址的行</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> address <span class="token operator">is</span> <span class="token boolean">null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="数据基本查询"><a href="#数据基本查询" class="header-anchor">#</a> 数据基本查询</h2> <h3 id="选择字段"><a href="#选择字段" class="header-anchor">#</a> 选择字段</h3> <h4 id="选择指定字段"><a href="#选择指定字段" class="header-anchor">#</a> 选择指定字段</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询stu表中的学生姓名与性别</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>sex <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="选择全部字段"><a href="#选择全部字段" class="header-anchor">#</a> 选择全部字段</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询stu表中的所有字段的详细信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="查询结果预处理"><a href="#查询结果预处理" class="header-anchor">#</a> 查询结果预处理</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询学生姓名及其对应的出生年份(假设表中没有出生年份字段，只有age字段)</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span><span class="token number">2019</span><span class="token operator">-</span>age <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>此时查询结果会显示无列名</p></blockquote> <div class="language- extra-class"><pre><code>| ID | NAME     |无列名|
+----+----------+-----+
|  1 | mike     |  19 |
|  2 | katy     |  25 |
|  3 | jason    |  20 |
|  4 | mimgming |  18 |
|  5 | hongh    |  21 |
|  6 | hanghang |  22 |
|  7 | peter    |  22 |
+----+----------+-----+
</code></pre></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询姓名与出生年份，并在出生年份前加入常量列“出生年份”</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span><span class="token string">'出生年份'</span><span class="token punctuation">,</span><span class="token number">2019</span><span class="token operator">-</span>age <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>| ID | NAME     |无列名   |无列名|

|  1 | mike     |出生年份 |  19 |
|  2 | katy     |出生年份 |  25 |
|  3 | jason    |出生年份 |  20 |
|  4 | mimgming |出生年份 |  18 |
|  5 | hongh    |出生年份 |  21 |
|  6 | hanghang |出生年份 |  22 |
|  7 | peter    |出生年份 |  22 |
</code></pre></div><h4 id="查询结果指定自定义字段名称"><a href="#查询结果指定自定义字段名称" class="header-anchor">#</a> 查询结果指定自定义字段名称</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询stu表中的的name和age，并指定各列的字段名称分别为姓名和年龄</span>
<span class="token keyword">select</span> name <span class="token keyword">as</span> 姓名<span class="token punctuation">,</span>age <span class="token keyword">as</span> 年龄
<span class="token keyword">from</span> student
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>| ID | 姓名      | 年龄 |
+----+----------+-----+
|  1 | mike     |  19 |
|  2 | katy     |  25 |
|  3 | jason    |  20 |
|  4 | mimgming |  18 |
|  5 | hongh    |  21 |
|  6 | hanghang |  22 |
|  7 | peter    |  22 |
+----+----------+-----+
</code></pre></div><h3 id="选择行"><a href="#选择行" class="header-anchor">#</a> 选择行</h3> <h4 id="限制结果集"><a href="#限制结果集" class="header-anchor">#</a> 限制结果集</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询stu表中的前5行</span>
<span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">5</span> <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="消除取值重复的行"><a href="#消除取值重复的行" class="header-anchor">#</a> 消除取值重复的行</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">distinct</span> sex <span class="token keyword">from</span> stu
<span class="token comment">-- 此时在查询结果中只会显示出&quot;男&quot;和“女”这两行。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="where条件查询"><a href="#where条件查询" class="header-anchor">#</a> where条件查询</h4> <blockquote><p>where语句不仅仅能用于select语句，还能与上面的update，delete语句相结合使用。</p></blockquote> <h5 id="等值查询与比较大小"><a href="#等值查询与比较大小" class="header-anchor">#</a> 等值查询与比较大小</h5> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询jason所在行的全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'jason'</span>

<span class="token comment">-- 查询年龄在20岁以下的人的全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> age <span class="token operator">&lt;</span> <span class="token number">20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="根据连续范围查询"><a href="#根据连续范围查询" class="header-anchor">#</a> 根据连续范围查询</h5> <blockquote><p>between...and语句和not between...and语句可以用来查找满足指定范围的行或者行中的部分字段。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询年龄在20-23岁的学生姓名以及家庭住址。</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>address <span class="token keyword">from</span> stu 
<span class="token keyword">where</span> age <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">30</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="根据集合范围查询"><a href="#根据集合范围查询" class="header-anchor">#</a> 根据集合范围查询</h5> <blockquote><p>使用in运算符可以查询满足某个集合的结果。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 返回满足20岁和21岁的学生的所有信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> age <span class="token operator">in</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="字符匹配查询"><a href="#字符匹配查询" class="header-anchor">#</a> 字符匹配查询</h5> <blockquote><p>使用like运算符可以实现字符的匹配查询</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询性“叶”的学生的详细信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'叶%'</span>
<span class="token comment">-- %意思是匹配一个或者多个字符，如果这个百分号在“叶”的前面就会查找姓名中最后一个字为“叶”的学生。</span>

<span class="token comment">-- 查询名字中第二个字为“云”或“风”的学生的所有信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'_[小大]%'</span>
<span class="token comment">-- []意为匹配[]中的任意一个字符，_意为匹配所有字符</span>

<span class="token comment">-- 查询学号最后一位不是2，3，5的学生的所有信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> <span class="token keyword">no</span> <span class="token operator">like</span> <span class="token string">'%[^235]'</span>
<span class="token comment">-- [^]意为不匹配[]中的字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="涉及到null的情况"><a href="#涉及到null的情况" class="header-anchor">#</a> 涉及到null的情况</h5> <blockquote><p>如果遇到空值要用is进行判断。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">--查询缺少地址信息的学生的全部信息。</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> address <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="and和or"><a href="#and和or" class="header-anchor">#</a> and和or</h5> <blockquote><p>and和or可以组合成多重条件查询</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询家住在beijing并且年龄为20岁以下的同学的全部信息。</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> address <span class="token operator">=</span> <span class="token string">'beijing'</span> <span class="token operator">and</span> age <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="数据排序查询"><a href="#数据排序查询" class="header-anchor">#</a> 数据排序查询</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将查询出来的学生的信息按照年龄升序排序</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">order</span> <span class="token keyword">by</span> age

<span class="token comment">-- 将查询出来的学生信息按照年龄降序排序，年龄如果相同的按成绩升序排序</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">order</span> <span class="token keyword">by</span> age <span class="token keyword">desc</span><span class="token punctuation">,</span>score<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="使用计算函数"><a href="#使用计算函数" class="header-anchor">#</a> 使用计算函数</h3> <h4 id="count-函数"><a href="#count-函数" class="header-anchor">#</a> count()函数</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 统计学生的总人数</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> student

<span class="token comment">--统计学生表中的地址种类一共有多少个</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> address<span class="token punctuation">)</span> <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="sum-函数和avg-函数"><a href="#sum-函数和avg-函数" class="header-anchor">#</a> sum()函数和avg()函数</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 计算stu表中的所有学生的年龄总值和平均值。</span>
<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">from</span> stu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="max-函数和min-函数"><a href="#max-函数和min-函数" class="header-anchor">#</a> max()函数和min()函数</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询家住beijing的同学中年龄最小的和年龄最大的。</span>
<span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> address <span class="token operator">=</span> <span class="token string">'beijing'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="对查询结果分组计算"><a href="#对查询结果分组计算" class="header-anchor">#</a> 对查询结果分组计算</h3> <h4 id="使用group-by语句"><a href="#使用group-by语句" class="header-anchor">#</a> 使用group by语句</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 统计不同区域的学生人数</span>
<span class="token keyword">select</span> address<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> stu <span class="token keyword">group</span> <span class="token keyword">by</span> address
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="into语句"><a href="#into语句" class="header-anchor">#</a> into语句</h3> <blockquote><p>into语句用于将查询的结果放到一个新表中</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询家住beijing的同学的所有信息，并将结果保存到beijing_stu表中</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> beijing_stu 
<span class="token keyword">from</span> stu
<span class="token keyword">where</span> address <span class="token operator">=</span> <span class="token string">'beijing'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h2> <h3 id="单值嵌套查询"><a href="#单值嵌套查询" class="header-anchor">#</a> 单值嵌套查询</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询stu中地址为beijing的学生的学号和成绩</span>
<span class="token keyword">select</span> <span class="token keyword">no</span><span class="token punctuation">,</span>grade
<span class="token keyword">from</span> stu
<span class="token keyword">where</span> area <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> area <span class="token keyword">from</span> area_table <span class="token keyword">where</span> address <span class="token operator">=</span> <span class="token string">'beijing'</span><span class="token punctuation">)</span>
<span class="token comment">--先从内查询中找出北京的区域号，然后再根据北京的区域号确定学生的学号和成绩</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="多值嵌套查询"><a href="#多值嵌套查询" class="header-anchor">#</a> 多值嵌套查询</h3> <h4 id="使用in运算符"><a href="#使用in运算符" class="header-anchor">#</a> 使用in运算符</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询成绩大于90分的学生的姓名和英语成绩</span>
<span class="token comment">-- 假设stu表中没有学生的英语成绩,但score表中有学号对应的成绩</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>english_score <span class="token keyword">from</span> stu
<span class="token keyword">where</span> <span class="token keyword">no</span> <span class="token operator">in</span><span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token keyword">no</span> <span class="token keyword">from</span> score
    <span class="token keyword">where</span> grade <span class="token operator">&gt;</span> <span class="token number">90</span> 
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="使用子查询进行比较测试"><a href="#使用子查询进行比较测试" class="header-anchor">#</a> 使用子查询进行比较测试</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询选修了&quot;数据结构&quot;并且成绩高于该课程平均分的学生的全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span> 
<span class="token operator">and</span> grade <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="使用any及all运算符"><a href="#使用any及all运算符" class="header-anchor">#</a> 使用any及all运算符</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询选修“数据结构”的学生成绩比选修&quot;离散数学&quot;的学生最低成绩高的学生全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span> 
<span class="token operator">and</span> grade <span class="token operator">&gt;</span> <span class="token keyword">any</span><span class="token punctuation">(</span><span class="token keyword">select</span> grade <span class="token keyword">from</span> stu <span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'离散数学'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- any(或some)意为满足其中任意一个值就返回true，条件较为宽松</span>

<span class="token comment">-- 查询选修&quot;数据结构&quot;的学生成绩比选修“离散数学”的学生最高成绩还要高的学生全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu
<span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span>
<span class="token operator">and</span> grade <span class="token operator">&gt;</span> <span class="token keyword">all</span><span class="token punctuation">(</span><span class="token keyword">select</span> grade <span class="token keyword">from</span> stu <span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'离散数学'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- all意为满足所有查询条件才会给你返回true，条件较为严格</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="连接查询"><a href="#连接查询" class="header-anchor">#</a> 连接查询</h2> <blockquote><p><strong>customers</strong>表中存储的消费者的详细信息</p></blockquote> <div class="language- extra-class"><pre><code>+----+----------+-----+-----------+----------+
| ID | NAME     | AGE | ADDRESS   | SALARY   |
+----+----------+-----+-----------+----------+
|  1 | Ramesh   |  32 | Ahmedabad |  2000.00 |
|  2 | Khilan   |  25 | Delhi     |  1500.00 |
|  3 | kaushik  |  23 | Kota      |  2000.00 |
|  4 | Chaitali |  24 | Mumbai    |  6500.00 |
|  5 | Hardik   |  27 | Bhopal    |  8500.00 |
|  6 | Komal    |  22 | MP        |  4500.00 |
|  7 | Muffy    |  24 | Indore    | 10000.00 |
+----+----------+-----+-----------+----------+
</code></pre></div><blockquote><p><strong>order</strong>表是也是顾客的消费信息，不过没有名字，只有对应的id</p></blockquote> <div class="language- extra-class"><pre><code>+-----+---------------------+-------------+--------+
|OID  | DATE                | CUSTOMER_ID | AMOUNT |
+-----+---------------------+-------------+--------+
| 102 | 2009-10-08 00:00:00 |           3 |   3000 |
| 100 | 2009-10-08 00:00:00 |           3 |   1500 |
| 101 | 2009-11-20 00:00:00 |           2 |   1560 |
| 103 | 2008-05-20 00:00:00 |           4 |   2060 |
+-----+---------------------+-------------+--------+
</code></pre></div><h3 id="自连接"><a href="#自连接" class="header-anchor">#</a> 自连接</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查询与muffy年龄相同的人的全部信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> customers cus1 <span class="token keyword">join</span> customers cus2
<span class="token keyword">on</span> cus1<span class="token punctuation">.</span>age <span class="token operator">=</span> cus2<span class="token punctuation">.</span>age
<span class="token keyword">where</span> cus1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'muffy'</span> <span class="token operator">and</span> cus2<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token string">'muffy'</span><span class="token punctuation">;</span>
<span class="token comment">-- 自连接是指一个表自己与自己建立连接，因此在逻辑上要分成两个表，并取别名。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="内部连接"><a href="#内部连接" class="header-anchor">#</a> 内部连接</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 根据orders表的内容查询其对应的id，姓名，购买量，消费日期。</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span>
<span class="token keyword">from</span> customers
<span class="token keyword">inner</span> <span class="token keyword">join</span> orders <span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id<span class="token punctuation">;</span>

<span class="token comment">-- 查询顾客购买量为3000的顾客的姓名和年龄。</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>age <span class="token keyword">from</span> customers
<span class="token keyword">inner</span> <span class="token keyword">join</span> orders <span class="token keyword">on</span> customer<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id
<span class="token keyword">where</span> orders<span class="token punctuation">.</span>amount <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="外部连接"><a href="#外部连接" class="header-anchor">#</a> 外部连接</h3> <h4 id="左外连接"><a href="#左外连接" class="header-anchor">#</a> 左外连接</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 根据顾客表查询全部顾客的id，姓名，购买量，购买日期。</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token keyword">from</span> customers 
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> orders
<span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id
<span class="token comment">-- 左外连接的意思就是将自己从左边连接一个表然后查询，此时查询的“视角”是自己，主要限制另一张表</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>输出结果</p></blockquote> <div class="language- extra-class"><pre><code>+----+----------+--------+---------------------+
| ID | NAME     | AMOUNT | DATE                |
+----+----------+--------+---------------------+
|  1 | Ramesh   |   NULL | NULL                |
|  2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|  3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|  3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|  4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
|  5 | Hardik   |   NULL | NULL                |
|  6 | Komal    |   NULL | NULL                |
|  7 | Muffy    |   NULL | NULL                |
+----+----------+--------+---------------------+
</code></pre></div><h4 id="右外连接"><a href="#右外连接" class="header-anchor">#</a> 右外连接</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 根据顾客表查询全部顾客的id，姓名，购买量，购买日期。</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token keyword">from</span> customers 
<span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> orders
<span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id
<span class="token comment">-- 右外连接的意思就是将自己从右边连接一个表然后查询，此时查询的“视角”是另一张表，主要限制自己</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>+------+----------+--------+---------------------+
| ID   | NAME     | AMOUNT | DATE                |
+------+----------+--------+---------------------+
|    3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|    3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|    2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|    4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
+------+----------+--------+---------------------+
</code></pre></div><h4 id="全连接"><a href="#全连接" class="header-anchor">#</a> 全连接</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 全连接会返回两个表的所有行，不管他们是否满足连接条件</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token keyword">from</span> customers 
<span class="token keyword">full</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> orders
<span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>+------+----------+--------+---------------------+
| ID   | NAME     | AMOUNT | DATE                |
+------+----------+--------+---------------------+
|    1 | Ramesh   |   NULL | NULL                |
|    2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|    3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|    3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|    4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
|    5 | Hardik   |   NULL | NULL                |
|    6 | Komal    |   NULL | NULL                |
|    7 | Muffy    |   NULL | NULL                |
|    3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|    3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|    2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|    4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
+------+----------+--------+---------------------+
</code></pre></div><h3 id="交叉连接"><a href="#交叉连接" class="header-anchor">#</a> 交叉连接</h3> <blockquote><p>交叉连接会返回两个连接表的所有数据行的笛卡尔积。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 将上面两个表全连接</span>
<span class="token keyword">select</span>  id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> <span class="token keyword">date</span>
<span class="token keyword">from</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>查询结果一共是4x7=28行</p></blockquote> <div class="language- extra-class"><pre><code>+----+----------+--------+---------------------+
| ID | NAME     | AMOUNT | DATE                |
+----+----------+--------+---------------------+
|  1 | Ramesh   |   3000 | 2009-10-08 00:00:00 |
|  1 | Ramesh   |   1500 | 2009-10-08 00:00:00 |
|  1 | Ramesh   |   1560 | 2009-11-20 00:00:00 |
|  1 | Ramesh   |   2060 | 2008-05-20 00:00:00 |
|  2 | Khilan   |   3000 | 2009-10-08 00:00:00 |
|  2 | Khilan   |   1500 | 2009-10-08 00:00:00 |
|  2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|  2 | Khilan   |   2060 | 2008-05-20 00:00:00 |
|  3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|  3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|  3 | kaushik  |   1560 | 2009-11-20 00:00:00 |
|  3 | kaushik  |   2060 | 2008-05-20 00:00:00 |
|  4 | Chaitali |   3000 | 2009-10-08 00:00:00 |
|  4 | Chaitali |   1500 | 2009-10-08 00:00:00 |
|  4 | Chaitali |   1560 | 2009-11-20 00:00:00 |
|  4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
|  5 | Hardik   |   3000 | 2009-10-08 00:00:00 |
|  5 | Hardik   |   1500 | 2009-10-08 00:00:00 |
|  5 | Hardik   |   1560 | 2009-11-20 00:00:00 |
|  5 | Hardik   |   2060 | 2008-05-20 00:00:00 |
|  6 | Komal    |   3000 | 2009-10-08 00:00:00 |
|  6 | Komal    |   1500 | 2009-10-08 00:00:00 |
|  6 | Komal    |   1560 | 2009-11-20 00:00:00 |
|  6 | Komal    |   2060 | 2008-05-20 00:00:00 |
|  7 | Muffy    |   3000 | 2009-10-08 00:00:00 |
|  7 | Muffy    |   1500 | 2009-10-08 00:00:00 |
|  7 | Muffy    |   1560 | 2009-11-20 00:00:00 |
|  7 | Muffy    |   2060 | 2008-05-20 00:00:00 |
+----+----------+--------+---------------------+
</code></pre></div><h2 id="集合运算查询"><a href="#集合运算查询" class="header-anchor">#</a> 集合运算查询</h2> <h3 id="并运算"><a href="#并运算" class="header-anchor">#</a> 并运算</h3> <blockquote><p>union操作符可以可以将最终的查询结果取并集
<strong>注意</strong>：参与任何集合运算的查询表结构应该相同</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 用union语句将之前的左外连接和右外连接并起来</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token keyword">from</span> customers 
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> orders
<span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id
<span class="token keyword">union</span>
<span class="token keyword">select</span> id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token keyword">from</span> customers
<span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> orders
<span class="token keyword">on</span> customers<span class="token punctuation">.</span>id <span class="token operator">=</span> orders<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>+------+----------+--------+---------------------+
| ID   | NAME     | AMOUNT | DATE                |
+------+----------+--------+---------------------+
|    1 | Ramesh   |   NULL | NULL                |
|    2 | Khilan   |   1560 | 2009-11-20 00:00:00 |
|    3 | kaushik  |   3000 | 2009-10-08 00:00:00 |
|    3 | kaushik  |   1500 | 2009-10-08 00:00:00 |
|    4 | Chaitali |   2060 | 2008-05-20 00:00:00 |
|    5 | Hardik   |   NULL | NULL                |
|    6 | Komal    |   NULL | NULL                |
|    7 | Muffy    |   NULL | NULL                |
+------+----------+--------+---------------------+
</code></pre></div><h3 id="交运算"><a href="#交运算" class="header-anchor">#</a> 交运算</h3> <blockquote><p><strong>intersect</strong>语句，用法和union语句类似，只不过最终是从两个查询结果里取交集。</p></blockquote> <h3 id="差运算"><a href="#差运算" class="header-anchor">#</a> 差运算</h3> <blockquote><p><strong>except</strong>语句，用法同上，会将第一个select结果中有，但是第二个select结果中没有的行返回。</p></blockquote> <h2 id="case函数查询"><a href="#case函数查询" class="header-anchor">#</a> case函数查询</h2> <h3 id="简单case函数"><a href="#简单case函数" class="header-anchor">#</a> 简单case函数</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*
假设学生表中有学生的选课信息
查询选了数据结构的学生的姓名，所在系和成绩。
其中所在系子段进行如下处理：
    当所在系为数学系时，显示为&quot;MA&quot;
    当所在系为计算机系时，显示为&quot;CS&quot;
*/</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>
<span class="token keyword">case</span> majored
    <span class="token keyword">when</span> <span class="token string">'数学系'</span> <span class="token keyword">then</span> <span class="token string">'MA'</span>
    <span class="token keyword">when</span> <span class="token string">'计算机系'</span> <span class="token keyword">then</span> <span class="token string">'CS'</span>
<span class="token keyword">end</span><span class="token punctuation">,</span>grade <span class="token keyword">from</span> stu <span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="搜索case函数"><a href="#搜索case函数" class="header-anchor">#</a> 搜索case函数</h3> <blockquote><p>搜索case函数可以完成范围内的情况判断。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/*
查询选修了数据结构的学生的考试情况，列出姓名以及是否及格
    其中成绩大于60分显示及格
    成绩小于60分显示不及格
*/</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span><span class="token keyword">case</span>
    <span class="token keyword">when</span> data_structure_score <span class="token operator">&gt;=</span> <span class="token number">60</span> <span class="token keyword">then</span> <span class="token string">'及格'</span>
    <span class="token keyword">when</span> data_structure_score <span class="token operator">&lt;</span> <span class="token number">60</span> <span class="token keyword">then</span> <span class="token string">'不及格'</span>
<span class="token keyword">end</span> <span class="token keyword">as</span> 是否及格 <span class="token keyword">from</span> stu <span class="token keyword">where</span> course <span class="token operator">=</span> <span class="token string">'数据结构'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h2> <blockquote><p>使用索引可以提高查询的速度，但是会降低更新和插入数据的速度。</p></blockquote> <h3 id="创建索引"><a href="#创建索引" class="header-anchor">#</a> 创建索引</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 为stu表的name字段再单独创建出一个非聚集索引</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> name_index <span class="token keyword">on</span> stu<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 为stu的id子段创建出一个唯一的聚集索引</span>
<span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">clustered</span> <span class="token keyword">index</span> id_index <span class="token keyword">on</span> stu<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 聚集索引用来确定表中数据的物理顺序。 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="管理索引"><a href="#管理索引" class="header-anchor">#</a> 管理索引</h3> <h4 id="查看索引"><a href="#查看索引" class="header-anchor">#</a> 查看索引</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查看stu表的索引信息</span>
<span class="token keyword">exec</span> sp_helpindex stu

<span class="token comment">-- 禁用id_index索引</span>
<span class="token keyword">alter</span> <span class="token keyword">index</span> id_index <span class="token keyword">on</span> stu <span class="token keyword">disable</span><span class="token punctuation">;</span>

<span class="token comment">-- 将name_index更改为xingming_index</span>
<span class="token keyword">exec</span> sp_rename <span class="token string">'stu.name_index'</span><span class="token punctuation">,</span><span class="token string">'xingming_index'</span><span class="token punctuation">,</span><span class="token string">'index'</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除stu表中的name_index索引。</span>
<span class="token keyword">drop</span> <span class="token keyword">index</span> name_index<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="视图"><a href="#视图" class="header-anchor">#</a> 视图</h2> <blockquote><p>视图简单来说就是存储在数据库中被封装好的select语句。</p></blockquote> <h3 id="创建视图"><a href="#创建视图" class="header-anchor">#</a> 创建视图</h3> <h4 id="单表视图"><a href="#单表视图" class="header-anchor">#</a> 单表视图</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建能够查询customers表中的姓名和年龄的视图</span>
<span class="token keyword">create</span> <span class="token keyword">view</span> customers_view <span class="token keyword">as</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>age
<span class="token keyword">from</span> customers<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="带检查项的视图"><a href="#带检查项的视图" class="header-anchor">#</a> 带检查项的视图</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在通过下面这个视图插入或者修改数据的时候就会拒绝age为null的条目。</span>
<span class="token keyword">create</span> <span class="token keyword">view</span> customers_view <span class="token keyword">as</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>age
<span class="token keyword">from</span> customers
<span class="token keyword">where</span> age <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">with</span> <span class="token keyword">check</span> <span class="token keyword">option</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="多表视图"><a href="#多表视图" class="header-anchor">#</a> 多表视图</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在stu和stu_detail上创建stu_info视图</span>
<span class="token keyword">create</span> stu_info <span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span>
<span class="token keyword">as</span> <span class="token keyword">select</span> stu<span class="token punctuation">.</span>id<span class="token punctuation">,</span>stu<span class="token punctuation">.</span>name<span class="token punctuation">,</span>stu_detail<span class="token punctuation">.</span>age
<span class="token keyword">from</span> stu<span class="token punctuation">,</span>stu_detail
<span class="token keyword">where</span> stu<span class="token punctuation">.</span>id <span class="token operator">=</span> stu_detail<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="加密视图"><a href="#加密视图" class="header-anchor">#</a> 加密视图</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建能够查询customers表中姓名和年龄的加密视图</span>
<span class="token keyword">create</span> <span class="token keyword">view</span> stu_encry <span class="token keyword">with</span> encryption
<span class="token keyword">as</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span>age
<span class="token keyword">from</span> customers<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="通过视图查询数据"><a href="#通过视图查询数据" class="header-anchor">#</a> 通过视图查询数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> customers_view<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>查询结果</p></blockquote> <div class="language- extra-class"><pre><code>+----------+-----+
| name     | age |
+----------+-----+
| Ramesh   |  32 |
| Khilan   |  25 |
| kaushik  |  23 |
| Chaitali |  25 |
| Hardik   |  27 |
| Komal    |  22 |
| Muffy    |  24 |
+----------+-----+
</code></pre></div><h3 id="通过视图修改数据"><a href="#通过视图修改数据" class="header-anchor">#</a> 通过视图修改数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 向customers_view中手动添加一个新的记录</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> customers_view
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'jason'</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 更新customers_view中的某段记录</span>
<span class="token keyword">update</span> customers_view
<span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'muffy'</span>
<span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'yffum'</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除customers_view中的某段记录</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> customers_view
<span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Komal'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="查看和重命名视图"><a href="#查看和重命名视图" class="header-anchor">#</a> 查看和重命名视图</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 使用sp_helptext存储过程查看name_view视图的定义信息</span>
<span class="token keyword">exec</span> sp_helptext <span class="token string">'sql.stu.name_view'</span><span class="token punctuation">;</span>

<span class="token comment">-- 把视图name_view重命名为xingming_view</span>
sp_rename name_view<span class="token punctuation">,</span>xingming_view<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="修改和删除视图"><a href="#修改和删除视图" class="header-anchor">#</a> 修改和删除视图</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 修改上面创建的customers_view，使其显示所有字段</span>
<span class="token keyword">alter</span> <span class="token keyword">view</span> customers_view
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> customers<span class="token punctuation">;</span>

<span class="token comment">-- 删除创建的视图</span>
<span class="token keyword">drop</span> <span class="token keyword">view</span> customers_view<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <h3 id="创建和调用函数"><a href="#创建和调用函数" class="header-anchor">#</a> 创建和调用函数</h3> <h4 id="创建和调用标量函数"><a href="#创建和调用标量函数" class="header-anchor">#</a> 创建和调用标量函数</h4> <blockquote><p>sql server的标量函数会接收n个参数并返回<strong>单个</strong>值。如果单独print调用函数最终会在打印结果上显示<strong>无列名</strong>。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 现有一张产品购买记录表，设计一个自定义函数，输入产品id，返回这个产品的购买数量。</span>
<span class="token keyword">create</span> <span class="token keyword">function</span> dbo<span class="token punctuation">.</span>count_products<span class="token punctuation">(</span>@ product_id <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token keyword">int</span>
<span class="token keyword">as</span>
<span class="token keyword">begin</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dbo<span class="token punctuation">.</span>products
    <span class="token keyword">where</span> id <span class="token operator">=</span> @ product_id
<span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- 调用刚才创建的函数</span>
<span class="token keyword">print</span> <span class="token string">'id号为3的产品购买了'</span><span class="token operator">+</span> <span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dbo<span class="token punctuation">.</span>count_products<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'种'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 这里在打印的时候需要通过convert函数将类型转换一下。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="创建和调用内联表值函数"><a href="#创建和调用内联表值函数" class="header-anchor">#</a> 创建和调用内联表值函数</h4> <blockquote><p>表值函数最终返回的是表类型的数据</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建表值函数，该函数根据产品年份返回产品信息，包括产品名称，年份和价格。</span>
<span class="token keyword">create</span> <span class="token keyword">function</span> udfProductInyear<span class="token punctuation">(</span><span class="token variable">@year</span> <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">returns</span> <span class="token keyword">table</span>
<span class="token keyword">as</span>
<span class="token keyword">return</span>
    <span class="token keyword">select</span> name<span class="token punctuation">,</span><span class="token keyword">year</span><span class="token punctuation">,</span>price <span class="token keyword">from</span> dbo<span class="token punctuation">.</span>products
    <span class="token keyword">where</span>
    <span class="token keyword">year</span> <span class="token operator">=</span> <span class="token variable">@year</span><span class="token punctuation">;</span>
<span class="token comment">-- 执行上面创建的函数</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> udfProductInyear<span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>执行结果</p></blockquote> <p><img src="https://www.yiibai.com/uploads/article/2019/02/26/143638_86640.png" alt=""></p> <h4 id="多语句表值函数"><a href="#多语句表值函数" class="header-anchor">#</a> 多语句表值函数</h4> <blockquote><p>多语句表值函数可以在函数内执行多个查询并将结果聚合到查询的表中。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 下面的函数会将员工和客户合并到同一张联系人表中</span>
<span class="token keyword">create</span> <span class="token keyword">function</span> udfContacts<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token variable">@contacts</span> <span class="token keyword">table</span><span class="token punctuation">(</span>
        first_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        phone <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">as</span>
    <span class="token keyword">begin</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token variable">@contacts</span>
    <span class="token keyword">select</span> 
        first_name<span class="token punctuation">,</span> 
        last_name<span class="token punctuation">,</span> 
        email<span class="token punctuation">,</span> 
        phone<span class="token punctuation">,</span>
        <span class="token string">'Staff'</span>
    <span class="token keyword">from</span>
        sales<span class="token punctuation">.</span>staffs<span class="token punctuation">;</span>

    <span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token variable">@contacts</span>
    <span class="token keyword">select</span> 
        first_name<span class="token punctuation">,</span> 
        last_name<span class="token punctuation">,</span> 
        email<span class="token punctuation">,</span> 
        phone<span class="token punctuation">,</span>
        <span class="token string">'Customer'</span>
    <span class="token keyword">from</span>
        sales<span class="token punctuation">.</span>customers<span class="token punctuation">;</span>
    <span class="token keyword">return</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="管理用户定义函数"><a href="#管理用户定义函数" class="header-anchor">#</a> 管理用户定义函数</h3> <h4 id="查看用户自定义函数"><a href="#查看用户自定义函数" class="header-anchor">#</a> 查看用户自定义函数</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>sp_helptext 函数名
<span class="token comment">-- 可用来查看用户定义函数的文本信息</span>
sp_help 函数名
<span class="token comment">-- 可用来查看用户定义函数的一般信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="删除用户自定义函数"><a href="#删除用户自定义函数" class="header-anchor">#</a> 删除用户自定义函数</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 删除上面创建的函数</span>
<span class="token keyword">drop</span> <span class="token keyword">function</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> udfContacts<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="游标"><a href="#游标" class="header-anchor">#</a> 游标</h2> <blockquote><p>有时候需要我们从结果中取一条条的记录，此时使用游标就会很有帮助</p></blockquote> <h3 id="声明游标"><a href="#声明游标" class="header-anchor">#</a> 声明游标</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 声明一个标准游标</span>
<span class="token keyword">declare</span> stu_cursor <span class="token keyword">cursor</span> <span class="token keyword">for</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> stu<span class="token punctuation">;</span>

<span class="token comment">-- 声明一个只读游标</span>
<span class="token keyword">declare</span> stu_cursor <span class="token keyword">cursor</span> <span class="token keyword">for</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">for</span> <span class="token keyword">read</span> only<span class="token punctuation">;</span>

<span class="token comment">-- 声明一个可更新游标</span>
<span class="token keyword">declare</span> stu_cursor <span class="token keyword">cursor</span> <span class="token keyword">for</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">for</span> <span class="token keyword">update</span><span class="token punctuation">;</span>

<span class="token comment">-- 声明一个动态游标</span>
<span class="token keyword">declare</span> stu_cursor CURSORScroll <span class="token keyword">for</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="打开游标"><a href="#打开游标" class="header-anchor">#</a> 打开游标</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">open</span> stu_cursor<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="读取游标数据"><a href="#读取游标数据" class="header-anchor">#</a> 读取游标数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 读取第一行的数据，并将游标放到第一行</span>
<span class="token keyword">fetch</span> <span class="token keyword">first</span> <span class="token keyword">from</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 读取从当前行开始的第3行</span>
<span class="token keyword">fetch</span> relative <span class="token number">3</span> <span class="token keyword">from</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 读取当前行的下一行数据</span>
<span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token keyword">from</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 读取第四行的数据</span>
<span class="token keyword">fetch</span> absolute <span class="token number">4</span> <span class="token keyword">from</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 读取最后一行的数据，并将游标放到最后一行</span>
<span class="token keyword">fetch</span> <span class="token keyword">last</span> <span class="token keyword">from</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 取出stu_cursor的数据，并保存到变量中</span>
<span class="token keyword">declare</span> <span class="token variable">@stu_id</span> nvarchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">fetch</span> <span class="token keyword">first</span> <span class="token keyword">from</span> stu_cursor <span class="token keyword">into</span> <span class="token variable">@stu_id</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="用游标修改和删除数据"><a href="#用游标修改和删除数据" class="header-anchor">#</a> 用游标修改和删除数据</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 通过游标修改当前行数据</span>
<span class="token keyword">update</span> stu <span class="token keyword">set</span> name <span class="token operator">=</span> <span class="token string">'jason'</span> <span class="token keyword">where</span> <span class="token keyword">current</span> <span class="token keyword">of</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 通过游标删除当前数据</span>
<span class="token keyword">delete</span> stu <span class="token keyword">where</span> <span class="token keyword">current</span> <span class="token keyword">of</span> stu_cursor<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="关闭和删除游标"><a href="#关闭和删除游标" class="header-anchor">#</a> 关闭和删除游标</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 关闭游标</span>
<span class="token keyword">close</span> stu_cursor<span class="token punctuation">;</span>

<span class="token comment">-- 删除游标</span>
<span class="token keyword">deallocate</span> stu_cursor<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <blockquote><p>事务是在数据库上按照一定逻辑顺序执行的任务队列，具有不可分割性。一旦操作失败，就会回滚到操作前的状态。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 假设现在要进行两个操作，这两个操作要被看做是一个整体的事务，一旦有一个操作失败，则回滚到之前的状态。</span>
<span class="token keyword">begin</span> try
    <span class="token keyword">begin</span> <span class="token keyword">tran</span> <span class="token comment">--设置事务的恢复点</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'jason'</span><span class="token punctuation">;</span>
    <span class="token keyword">commit</span> <span class="token keyword">tran</span> <span class="token comment">--如果都成功，就提交事务</span>
<span class="token keyword">end</span> try

<span class="token keyword">begin</span> catch
    <span class="token keyword">rollback</span> <span class="token keyword">tran</span> <span class="token comment">-- 一旦失败报异常就回滚</span>
<span class="token keyword">end</span> catch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h2> <blockquote><p>存储过程简单来说就是封装好的一段sql语句，其中有些存储过程像系统自带的函数一样已经被封装好了。
存储过程相对于函数而言操作权限更高，功能也更为复杂，函数实现的功能针对性要更强一些。</p></blockquote> <h3 id="存储过程创建"><a href="#存储过程创建" class="header-anchor">#</a> 存储过程创建</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建一个简单的存储过程p1,查询所有学生信息，并按照成绩的降序排列 </span>
<span class="token keyword">create</span> <span class="token keyword">proc</span> p1
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">order</span> <span class="token keyword">by</span> score <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建存储过程p2,查询指定课程号的学生信息.</span>
<span class="token keyword">create</span> <span class="token keyword">proc</span> p2
<span class="token variable">@course_id</span> <span class="token keyword">int</span>  <span class="token comment">--外部参数</span>
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stu <span class="token keyword">where</span> course_id <span class="token operator">=</span> <span class="token variable">@course_id</span>

<span class="token comment">-- 创建存储过程p3，查询指定学号学生的英语成绩并返回。</span>
<span class="token keyword">create</span> <span class="token keyword">proc</span> p3
<span class="token variable">@stu_id</span> <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token variable">@english_score</span> <span class="token keyword">int</span> output
<span class="token keyword">as</span>
<span class="token keyword">select</span> english_score <span class="token keyword">from</span> stu <span class="token keyword">where</span> stu_id <span class="token operator">=</span> <span class="token variable">@stu_id</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="存储过程执行"><a href="#存储过程执行" class="header-anchor">#</a> 存储过程执行</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 执行p1</span>
<span class="token keyword">exec</span> p1<span class="token punctuation">;</span>

<span class="token comment">-- 执行p2</span>
<span class="token keyword">exec</span> p2 <span class="token number">002</span><span class="token punctuation">;</span>

<span class="token comment">-- 执行p3</span>
<span class="token keyword">declare</span> <span class="token variable">@tmp</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 指定时要把返回值保存到变量中。</span>
<span class="token keyword">exec</span> p3 <span class="token number">002</span><span class="token punctuation">,</span><span class="token variable">@tmp</span> output<span class="token punctuation">;</span> 
<span class="token keyword">print</span> <span class="token string">'英语成绩为'</span><span class="token operator">+</span> <span class="token variable">@tmp</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="删除存储过程"><a href="#删除存储过程" class="header-anchor">#</a> 删除存储过程</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">proc</span> p1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h2> <blockquote><p>触发器是一种特殊的存储过程，它们会自动的响应数据库的某些变动。</p></blockquote> <h3 id="dml触发器"><a href="#dml触发器" class="header-anchor">#</a> DML触发器</h3> <blockquote><p>数据操作语言触发器，用于响应表中的insert，delete，update事件。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 创建一个关于学生表的触发器，一旦要变更学生表的内容时，就执行回滚操作。</span>
<span class="token keyword">create</span> <span class="token keyword">trigger</span> tr1 <span class="token keyword">on</span> stu <span class="token keyword">after</span> <span class="token keyword">delete</span><span class="token punctuation">,</span><span class="token keyword">insert</span><span class="token punctuation">,</span><span class="token keyword">update</span>
<span class="token keyword">as</span>
<span class="token keyword">rollback</span> <span class="token keyword">tran</span>
<span class="token keyword">print</span><span class="token string">'学生表的内容不能动!'</span>
<span class="token comment">-- after的位置如果换成了insted of就成了替代触发器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="ddl触发器"><a href="#ddl触发器" class="header-anchor">#</a> DDL触发器</h3> <blockquote><p>数据定义语言触发器,用于响应表中的create,alter,drop事件。</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 在school数据库中创建一个DDL触发器,用来防止该数据库中的任一表被修改或删除</span>
<span class="token keyword">use</span> school
go
<span class="token keyword">create</span> <span class="token keyword">trigger</span> tr2 <span class="token keyword">on</span> <span class="token keyword">database</span> <span class="token keyword">after</span> drop_table<span class="token punctuation">,</span>alter_table
<span class="token keyword">as</span>
<span class="token keyword">begin</span> 
<span class="token keyword">raiserror</span><span class="token punctuation">(</span><span class="token string">'不能修改表结构'</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">rollback</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="管理触发器"><a href="#管理触发器" class="header-anchor">#</a> 管理触发器</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 查看用户创建的触发器,和存储过程的操作是一样的</span>
<span class="token keyword">exec</span> sp_help 触发器名
<span class="token keyword">exec</span> sp_helptext 触发器名
<span class="token keyword">exec</span> sp_depends 触发器名 <span class="token comment">--用于显示和触发器相关的数据库对象</span>

<span class="token comment">-- 删除触发器</span>
<span class="token keyword">drop</span> <span class="token keyword">trigger</span> 触发器名

<span class="token comment">-- 禁用触发器</span>
<span class="token keyword">disable</span> <span class="token keyword">trigger</span> 触发器名 <span class="token keyword">on</span> 表名 <span class="token comment">--禁用对表的DML触发器</span>
<span class="token keyword">disable</span> <span class="token keyword">trigger</span> 触发器名 <span class="token keyword">on</span> <span class="token keyword">database</span> <span class="token comment">--禁用DDL触发器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/22/2021, 5:42:12 PM</span></div></footer> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4d15b3ce.js" defer></script><script src="/assets/js/3.8b0ceda2.js" defer></script><script src="/assets/js/1.ecdf2037.js" defer></script><script src="/assets/js/55.ec8677c2.js" defer></script>
  </body>
</html>
